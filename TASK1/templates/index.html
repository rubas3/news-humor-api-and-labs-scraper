<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>News to Humor</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">

<div class="container py-5">
    <h2 class="text-center mb-4">ðŸ“° News â†’ Humor Generator</h2>

    <form id="newsForm" class="row g-3 justify-content-center">
        <!-- Country Dropdown -->
        <div class="col-md-4">
            <select id="country" class="form-select">
                <option value="">Select Country</option>
                <option value="ae">United Arab Emirates</option>
                <option value="ar">Argentina</option>
                <option value="at">Austria</option>
                <option value="au">Australia</option>
                <option value="be">Belgium</option>
                <option value="bg">Bulgaria</option>
                <option value="br">Brazil</option>
                <option value="ca">Canada</option>
                <option value="ch">Switzerland</option>
                <option value="cn">China</option>
                <option value="co">Colombia</option>
                <option value="cu">Cuba</option>
                <option value="cz">Czech Republic</option>
                <option value="de">Germany</option>
                <option value="eg">Egypt</option>
                <option value="fr">France</option>
                <option value="gb">United Kingdom</option>
                <option value="gr">Greece</option>
                <option value="hk">Hong Kong</option>
                <option value="hu">Hungary</option>
                <option value="id">Indonesia</option>
                <option value="ie">Ireland</option>
                <option value="il">Israel</option>
                <option value="in">India</option>
                <option value="it">Italy</option>
                <option value="jp">Japan</option>
                <option value="kr">South Korea</option>
                <option value="lt">Lithuania</option>
                <option value="lv">Latvia</option>
                <option value="ma">Morocco</option>
                <option value="mx">Mexico</option>
                <option value="my">Malaysia</option>
                <option value="ng">Nigeria</option>
                <option value="nl">Netherlands</option>
                <option value="no">Norway</option>
                <option value="nz">New Zealand</option>
                <option value="ph">Philippines</option>
                <option value="pl">Poland</option>
                <option value="pt">Portugal</option>
                <option value="ro">Romania</option>
                <option value="rs">Serbia</option>
                <option value="ru">Russia</option>
                <option value="sa">Saudi Arabia</option>
                <option value="se">Sweden</option>
                <option value="sg">Singapore</option>
                <option value="si">Slovenia</option>
                <option value="sk">Slovakia</option>
                <option value="th">Thailand</option>
                <option value="tr">Turkey</option>
                <option value="tw">Taiwan</option>
                <option value="ua">Ukraine</option>
                <option value="us">United States</option>
                <option value="ve">Venezuela</option>
                <option value="za">South Africa</option>
            </select>
        </div>

        <!-- Category Dropdown -->
        <div class="col-md-4">
            <select id="category" class="form-select">
                <option value="">Select Category</option>
                <option value="business">Business</option>
                <option value="technology">Technology</option>
                <option value="sports">Sports</option>
                <option value="health">Health</option>
                <option value="entertainment">Entertainment</option>
                <option value="science">Science</option>
                <option value="general">General</option>
            </select>
        </div>

        <div class="col-md-2">
            <button class="btn btn-primary w-100">Fetch</button>
        </div>
    </form>

    <!-- Loading Spinner -->
    <div id="loading" class="text-center mt-4 d-none">
        <div class="spinner-border text-primary"></div>
        <p>Processing news...</p>
    </div>

    <!-- Results -->
    <div id="results" class="mt-4"></div>
</div>

<script>
document.getElementById("newsForm").addEventListener("submit", async function(e) {
    e.preventDefault();

    const country = document.getElementById("country").value;
    const category = document.getElementById("category").value;

    let url = "/humor-news?";
    if (country) url += `country=${country}&`;
    if (category) url += `category=${category}`;

    const resultsDiv = document.getElementById("results");
    resultsDiv.innerHTML = "";
    document.getElementById("loading").classList.remove("d-none");

    try {
        const response = await fetch(url);
        const data = await response.json();
        document.getElementById("loading").classList.add("d-none");

        if (!data.data || data.data.length === 0) {
            resultsDiv.innerHTML = "<p class='text-warning'>No articles found for this selection.</p>";
            return;
        }

        let html = "";
        data.data.forEach(item => {
            html += `
            <div class="card mb-3 shadow-sm">
                <div class="card-body">
                    <h5>${item.title}</h5>
                    <p class="text-muted mb-1"><strong>Author:</strong> ${item.author || 'Unknown'}</p>
                    <p><strong>Original:</strong> ${item.original_description}</p>
                    <p class="text-success"><strong>Humorous:</strong> ${item.humorous_description}</p>
                </div>
            </div>`;
        });
        resultsDiv.innerHTML = html;

    } catch (err) {
        console.error(err);
        document.getElementById("loading").classList.add("d-none");
        resultsDiv.innerHTML = "<p class='text-danger'>Something went wrong. Check console.</p>";
    }
});
</script>

</body>
</html>
