<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>News to Humor</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">

<div class="container py-5">
    <h2 class="text-center mb-4">ðŸ“° News â†’ Humor Generator</h2>

    <form id="newsForm" class="row g-3 justify-content-center">
        <div class="col-md-4">
            <select id="country" class="form-select">
                <option value="">Select Country</option>
                <option value="us">United States</option>
                <option value="pk">Pakistan</option>
                <option value="in">India</option>
                <option value="gb">United Kingdom</option>
            </select>
        </div>

        <div class="col-md-4">
            <select id="category" class="form-select">
                <option value="">Select Category</option>
                <option value="business">Business</option>
                <option value="technology">Technology</option>
                <option value="sports">Sports</option>
                <option value="health">Health</option>
                <option value="entertainment">Entertainment</option>
                <option value="science">Science</option>
            </select>
        </div>

        <div class="col-md-2">
            <button class="btn btn-primary w-100">Fetch</button>
        </div>
    </form>

    <div id="loading" class="text-center mt-4 d-none">
        <div class="spinner-border text-primary"></div>
        <p>Processing news...</p>
    </div>

    <div id="results" class="mt-4"></div>
</div>

<script>
document.getElementById("newsForm").addEventListener("submit", async function(e) {
    e.preventDefault();

    const country = document.getElementById("country").value;
    const category = document.getElementById("category").value;

    let url = "/humor-news?";
    if (country) url += `country=${country}&`;
    if (category) url += `category=${category}`;

    document.getElementById("results").innerHTML = "";
    document.getElementById("loading").classList.remove("d-none");

    try {
        const response = await fetch(url);
        if (!response.ok) throw new Error("Server error");

        const data = await response.json();
        document.getElementById("loading").classList.add("d-none");

        if (data.data.length === 0) {
            document.getElementById("results").innerHTML =
                "<p class='text-warning'>No articles found.</p>";
            return;
        }

        data.data.forEach(item => {
                document.getElementById("results").innerHTML += `
                    <div class="card mb-3 shadow-sm">
                        <div class="card-body">
                            <h5>${item.title}</h5>
                            <p class="text-muted mb-1">
                                <strong>Author:</strong> ${item.author}
                            </p>
                            <p><strong>Original:</strong> ${item.original_description}</p>
                            <p class="text-success">
                                <strong>Humorous:</strong> ${item.humorous_description}
                            </p>
                        </div>
                    </div>
                `;
            });



    } catch (err) {
        console.error(err);
        document.getElementById("loading").classList.add("d-none");
        document.getElementById("results").innerHTML =
            "<p class='text-danger'>Something went wrong. Check console.</p>";
    }
});
</script>

</body>
</html>
